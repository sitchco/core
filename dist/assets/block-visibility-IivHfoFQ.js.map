{"version":3,"file":"block-visibility-IivHfoFQ.js","sources":["../../modules/Wordpress/assets/scripts/block-visibility.js"],"sourcesContent":["import domReady from '@wordpress/dom-ready';\nimport { unregisterBlockType } from '@wordpress/blocks';\nimport { select, subscribe } from '@wordpress/data';\n\n((wp, config) => {\n    const checkBlockVisibility = (blockName, postType, context) => {\n        const rule = config[blockName];\n        if (!rule) {\n            return false;\n        }\n\n        const { allowPostType, allowContext } = rule;\n        const postTypeMatch = allowPostType ? Boolean(allowPostType[postType]) : false;\n        const contextMatch = allowContext ? Boolean(allowContext[context]) : false;\n        return (allowPostType || allowContext) && !(postTypeMatch || contextMatch);\n    };\n\n    const initializeBlockVisibility = (editor, postType) => {\n        const isSiteEditor = !!select('core/edit-site');\n        const editorContext = isSiteEditor ? 'core/edit-site' : 'core/edit-post';\n\n        wp.blocks.getBlockTypes().forEach(({ name }) => {\n            if (checkBlockVisibility(name, postType, editorContext)) {\n                unregisterBlockType(name);\n            }\n        });\n    };\n\n    domReady(() => {\n        const unsubscribe = subscribe(() => {\n            const editor = select('core/editor');\n            if (!editor?.getCurrentPostType) {\n                return;\n            }\n\n            const postType = editor.getCurrentPostType();\n            if (!postType) {\n                return;\n            }\n\n            unsubscribe();\n            initializeBlockVisibility(editor, postType);\n        });\n    });\n})(window.wp, window.sitchcoBlockVisibility || {});\n"],"names":["wp","config","checkBlockVisibility","blockName","postType","context","rule","allowPostType","allowContext","postTypeMatch","contextMatch","initializeBlockVisibility","editor","editorContext","name","unsubscribe"],"mappings":"CAIA,CAAAA,EAAAC,IAAA,CACA,MAAAC,EAAA,CAAAC,EAAAC,EAAAC,IAAA,CACA,MAAAC,EAAAL,EAAAE,CAAA,EACA,GAAA,CAAAG,EACA,MAAA,GAGA,KAAA,CAAA,cAAAC,EAAA,aAAAC,CAAA,EAAAF,EACAG,EAAAF,EAAA,EAAAA,EAAAH,CAAA,EAAA,GACAM,EAAAF,EAAA,EAAAA,EAAAH,CAAA,EAAA,GACA,OAAAE,GAAAC,IAAA,EAAAC,GAAAC,EACA,EAEAC,EAAA,CAAAC,EAAAR,IAAA,CAEA,MAAAS,EADA,CAAA,CAA+Bb,EAAA,KAAA,OAAM,gBAAA,EACrC,iBAAA,iBAEAA,EAAA,OAAA,cAAA,EAAA,QAAA,CAAA,CAAA,KAAAc,KAAA,CACAZ,EAAAY,EAAAV,EAAAS,CAAA,GACgBb,EAAA,OAAA,oBAAmBc,CAAA,CAEnC,CAAA,CACA,EAEId,EAAA,SAAQ,IAAA,CACZ,MAAAe,EAA4Bf,EAAA,KAAA,UAAS,IAAA,CACrC,MAAAY,EAA2BZ,EAAA,KAAA,OAAM,aAAA,EACjC,GAAA,CAAAY,GAAA,mBACA,OAGA,MAAAR,EAAAQ,EAAA,mBAAA,EACAR,IAIAW,EAAA,EACAJ,EAAAC,EAAAR,CAAA,EACA,CAAA,CACA,CAAA,CACA,GAAA,OAAA,GAAA,OAAA,wBAAA,CAAA,CAAA"}